<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬äº”äººæ ¼æ’ä½è®¡ç®—å™¨</title>
    <style>
        :root {
            --primary-color: #0066ff;
            --primary-hover: #0052cc;
            --background-color: #f4f6f9;
            --surface-color: #ffffff;
            --text-color: #2c3e50;
            --border-color: #e0e6ed;
            --success-bg: #e6f7f0;
            --success-border: #00b069;
            --section-header-bg: #f8faff;
        }
        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        body {
            font-family: 'Helvetica Neue', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', 'Microsoft YaHei', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            width: 100%;
            max-width: 920px;
            background-color: var(--surface-color);
            padding: 20px 28px 30px 28px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }
        h1 {
            text-align: center;
            color: #1a2c50;
            margin-bottom: 18px;
        }
        .section {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 18px;
            overflow: hidden;
            transition: box-shadow 0.3s;
        }
        .section-header {
            background-color: var(--section-header-bg);
            padding: 12px 18px;
            font-size: 1.05em;
            font-weight: 600;
            border-bottom: 1px solid var(--border-color);
        }
        .section-content { padding: 18px; }
        .form-group { margin-bottom: 16px; }
        .form-group label {
            display: flex; align-items: center; margin-bottom: 8px;
            font-weight: 500; color: #555;
        }
        input[type="number"], select {
            width: 100%; padding: 10px; border: 1px solid var(--border-color);
            border-radius: 8px; box-sizing: border-box; transition: all 0.25s;
        }
        input[type="range"] { width: 100%; }
        input[type="number"]:focus, select:focus {
            outline: none; border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.12);
        }
        .rank-selector { display: grid; grid-template-columns: 2fr 2fr 1.5fr; gap: 10px; }
        .button-group { display: flex; gap: 12px; margin-top: 8px; }
        button {
            flex: 1; padding: 12px; color: white; border: none; border-radius: 8px;
            font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.25s;
        }
        #calculateBtn { background: linear-gradient(45deg, var(--primary-color), var(--primary-hover)); }
        #calculateBtn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 102, 255, 0.18); }
        #resetFormBtn { background-color: #6c757d; }
        #resetFormBtn:hover { background-color: #5a6268; transform: translateY(-2px); }
        #result {
            margin-top: 18px; padding: 18px; background-color: var(--success-bg);
            border-left: 5px solid var(--success-border); border-radius: 8px;
            display: none; animation: fadeInSlideUp 0.45s ease-out forwards;
        }
        #result p { margin: 8px 0; font-size: 1.03em;}
        .error { color: #d93025; font-weight: 500; text-align: center; margin-top: 12px; padding: 10px; border-radius: 8px; background: #fbeae9; display: none; }
        .tooltip {
            position: relative; display: inline-flex; justify-content: center; align-items: center;
            width: 18px; height: 18px; margin-left: 8px; background-color: #a0aec0; color: white; border-radius: 50%;
            font-family: serif; font-style: italic; font-weight: bold; font-size: 14px; cursor: pointer; user-select: none;
        }
        .tooltip .tooltiptext {
            visibility: hidden; width: 280px; background-color: #343a40; color: #fff;
            text-align: left; border-radius: 6px; padding: 10px; position: absolute;
            z-index: 1; bottom: 125%; left: 50%; margin-left: -140px; opacity: 0;
            transition: opacity 0.25s; font-size: 0.86em;
        }
        .tooltip:hover { background-color: var(--primary-color); }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
        .slider-group { display: flex; align-items: center; gap: 12px; }
        .slider-group input[type="range"] { flex: 1; }
        .slider-group span { font-weight: 500; min-width: 48px; text-align: right; }
        .footer { text-align: center; margin-top: 28px; padding-top: 14px; border-top: 1px solid var(--border-color); }
        .author-credit { font-weight: 600; color: var(--text-color); margin-bottom: 8px; font-size: 0.9em; }
        .disclaimer { font-size: 0.82em; color: #6c757d; margin: 0; }
        @media (max-width: 760px) {
            .container { padding: 14px; }
            .rank-selector { grid-template-columns: 1fr; }
            .button-group { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç¬¬äº”äººæ ¼æ’ä½è®¡ç®—å™¨</h1>
        
        <form id="calculator-form">
            <div class="section">
                <div class="section-header">â‘  æ ¸å¿ƒå‚æ•°</div>
                <div class="section-content">
                    <div class="form-group">
                        <label for="startTier">åˆå§‹æ®µä½</label>
                        <div class="rank-selector">
                            <select id="startTier"></select>
                            <select id="startSubTier"></select>
                            <select id="startStars"></select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="targetTier">ç›®æ ‡æ®µä½</label>
                        <div class="rank-selector" style="grid-template-columns: 1fr 1fr;">
                            <select id="targetTier"></select>
                            <select id="targetSubTier"></select>
                        </div>
                        <div id="peak-star-target-wrapper" class="form-group" style="display:none; margin-top: 10px;">
                            <label for="peakTargetStars">è¾“å…¥ç›®æ ‡æ˜Ÿæ•°ï¼ˆå·…å³°ä¸ƒé˜¶ï¼‰</label>
                            <input type="number" id="peakTargetStars" value="26" min="26">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="gameWinRate">æ¸¸æˆå†…æ’ä½èƒœç‡ (%) 
                            <div class="tooltip">i<span class="tooltiptext">è¯·å¡«å…¥ä¸ªäººæ¡£æ¡ˆä¸­çš„â€œæ’ä½èƒœç‡â€ï¼šèƒœå±€ / (æ€»å±€æ•° - å¹³å±€æ•°)ã€‚</span></div>
                        </label>
                        <input type="number" id="gameWinRate" placeholder="ä¾‹å¦‚: 50" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label for="totalDrawRate">å¹³å±€åœ¨æ€»å¯¹å±€ä¸­çš„é¢„ä¼°å æ¯” (%) 
                            <div class="tooltip">i<span class="tooltiptext">ä¾‹ï¼š10å±€é‡Œ2å±€å¹³å±€åˆ™å¡« 20ã€‚ç”¨äºåæ¨çœŸå®çš„èƒœ/è´Ÿæ¦‚ç‡ã€‚</span></div>
                        </label>
                        <input type="number" id="totalDrawRate" placeholder="ä¾‹å¦‚: 15" min="0" max="100">
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">â‘¡ æ¸¸æˆä¹ æƒ¯ä¸é¢å¤–åŠ åˆ†é¡¹</div>
                <div class="section-content">
                     <div class="form-group">
                        <label>é€‰æ‹©é˜µè¥</label>
                        <select id="faction-select">
                            <option value="survivor">æ±‚ç”Ÿè€…</option>
                            <option value="hunter">ç›‘ç®¡è€…</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="queueTime">å¹³å‡æ’é˜Ÿ+BPæ—¶é—´ (åˆ†é’Ÿ)</label>
                        <input type="number" id="queueTime" placeholder="ä¾‹å¦‚: 3" min="0">
                    </div>
                    <div class="form-group">
                        <label for="matchTime">å¹³å‡å¯¹å±€æ—¶é—´ (åˆ†é’Ÿ)</label>
                        <input type="number" id="matchTime" placeholder="ä¾‹å¦‚: 10" min="0">
                    </div>
                    <div class="form-group">
                        <label for="playHours">æ¯æ—¥æ’ä½æ—¶é•¿ (å°æ—¶)</label>
                        <input type="number" id="playHours" placeholder="ä¾‹å¦‚: 2" min="0">
                    </div>
                    
                    <div id="survivor-options">
                        <div class="form-group">
                            <label><input type="checkbox" id="isSolo"> æˆ‘æ˜¯å•äººæ’ä½</label>
                        </div>
                        <div class="form-group">
                            <label>â€œè™½è´¥çŠ¹è£â€åŠ åˆ†é¢‘ç‡
                                 <div class="tooltip">i<span class="tooltiptext">åœ¨è´¥/å¹³å±€ä¸­ï¼Œæ‚¨æœ‰å‡ ç‡è·å¾—è¡¨ç°ç±»é¢å¤–åŠ åˆ†ï¼ˆä¾‹å¦‚ç‰µåˆ¶ã€æ•‘æ´ç­‰ï¼‰ï¼Ÿ</span></div>
                            </label>
                             <div class="slider-group">
                                <input type="range" id="diligenceFreq" min="0" max="100" value="35" step="1">
                                <span id="diligenceFreqValue">35%</span>
                            </div>
                        </div>
                         <div class="form-group">
                            <label>é˜Ÿå‹æŒ‚æœºé¢‘ç‡
                                 <div class="tooltip">i<span class="tooltiptext">é¢„ä¼°æ‚¨é‡åˆ°é˜Ÿå‹æŒ‚æœºå¹¶å› æ­¤è·å¾—è¡¥å¿åˆ†çš„å¯¹å±€å æ¯”ã€‚</span></div>
                            </label>
                             <div class="slider-group">
                                <input type="range" id="afkFreq" min="0" max="100" value="1" step="0.5">
                                <span id="afkFreqValue">1%</span>
                            </div>
                        </div>
                    </div>
                    <div id="hunter-options" style="display: none;">
                        <div class="form-group">
                            <label>å¹³/è´Ÿå±€è·å¾—â€œæœ€ä½³æ¼”ç»â€åŠ åˆ†é¢‘ç‡</label>
                             <div class="slider-group">
                                <input type="range" id="bestPerfFreq" min="0" max="100" value="45" step="1">
                                <span id="bestPerfFreqValue">45%</span>
                            </div>
                        </div>
                         <div class="form-group">
                            <label>é‡åˆ°å¤šæ’é˜Ÿä¼åŠ åˆ†é¢‘ç‡ (é»˜å¥‘çš„å¯¹æ‰‹)
                                <div class="tooltip">i<span class="tooltiptext">é¢„ä¼°æ‚¨é‡åˆ°å¤šæ’é˜Ÿä¼å¹¶è·å¾—é¢å¤–åˆ†çš„å‡ ç‡ï¼ˆé«˜æ®µä½æ›´å¸¸è§ï¼‰ã€‚</span></div>
                            </label>
                            <div class="slider-group">
                                <input type="range" id="teamEncounterFreq" min="0" max="100" value="60" step="1">
                                <span id="teamEncounterFreqValue">60%</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>é‡åˆ°å¼ºæ•ŒåŠ åˆ†é¢‘ç‡ (åŠ›æŠ—å¼ºæ•Œ/åŠ›æˆ˜å¤©é€‰)
                             <div class="tooltip">i<span class="tooltiptext">é¢„ä¼°æ‚¨é‡åˆ°æ®µä½æ˜æ˜¾é«˜äºè‡ªèº«å¹¶è·å¾—è¡¥å¿åˆ†çš„å¯¹å±€å æ¯”ã€‚</span></div>
                        </label>
                         <div class="slider-group">
                            <input type="range" id="strongEnemyFreq" min="0" max="100" value="70" step="1">
                            <span id="strongEnemyFreqValue">70%</span>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        
        <div class="button-group">
            <button id="calculateBtn" type="button">ğŸš€ å¼€å§‹è®¡ç®—</button>
            <button id="resetFormBtn" type="button">ğŸ”„ ä¸€é”®é‡ç½®</button>
        </div>
        <div id="error-message" class="error"></div>
        <div id="result"></div>
        
        <div class="section" style="margin-top: 20px;">
             <div class="section-header">â‘¢ èµ›å­£æ®µä½é‡ç½®å·¥å…·</div>
             <div class="section-content">
                 <div class="form-group">
                     <label for="seasonEndTier">é€‰æ‹©æ‚¨çš„èµ›å­£æœ«æ®µä½</label>
                     <div class="rank-selector" style="grid-template-columns: 1fr 1fr;">
                         <select id="seasonEndTier"></select>
                         <select id="seasonEndSubTier"></select>
                     </div>
                 </div>
                 <div class="form-group" style="display: flex; justify-content: center;">
                    <button id="resetBtn" type="button">æŸ¥çœ‹æ–°èµ›å­£æ®µä½</button>
                 </div>
                 <div id="resetResult" style="text-align: center; margin-top: 12px; font-weight: bold; font-size: 1.02em;"></div>
             </div>
         </div>
         
         <div class="footer">
            <p class="author-credit">ä½œè€…Bç«™ï¼šé¢æˆ‘æ˜¯WZäºº</p>
            <p class="disclaimer">å…è´£å£°æ˜ï¼šæœ¬è®¡ç®—ä¸ºåŸºäºè§„åˆ™ä¸å¹³å‡æœŸæœ›çš„ç†è®ºä¼°ç®—ï¼Œç»“æœå—å‚æ•°å‡†ç¡®æ€§å½±å“ï¼Œä»…ä¾›å‚è€ƒã€‚</p>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const rankData = [
            {id:1,name:"ä¸€é˜¶",subTiers:3,starsPerSub:3,pointsPerStar:20},
            {id:2,name:"äºŒé˜¶",subTiers:4,starsPerSub:4,pointsPerStar:20},
            {id:3,name:"ä¸‰é˜¶",subTiers:5,starsPerSub:5,pointsPerStar:20},
            {id:4,name:"å››é˜¶",subTiers:5,starsPerSub:5,pointsPerStar:20},
            {id:5,name:"äº”é˜¶",subTiers:5,starsPerSub:5,pointsPerStar:30},
            {id:6,name:"å…­é˜¶",subTiers:5,starsPerSub:5,pointsPerStar:30},
            {id:7,name:"ä¸ƒé˜¶",subTiers:1,starsPerSub:25,pointsPerStar:30},
            {id:8,name:"å·…å³°ä¸ƒé˜¶",subTiers:1,starsPerSub:Infinity,pointsPerStar:30}
        ];
        const subTierNames = ["I","II","III","IV","V"];

        let pointsToStartTier = {};
        let totalPointsMap = {};
        let currentTotalPoints = 0;

        pointsToStartTier[1] = 0;
        rankData.forEach(tier => {
            if (tier.id > 1) { pointsToStartTier[tier.id] = currentTotalPoints; }
            if (tier.name !== "å·…å³°ä¸ƒé˜¶") {
                const pointsInTier = (tier.starsPerSub === Infinity ? 25 : tier.starsPerSub * tier.subTiers) * tier.pointsPerStar;
                currentTotalPoints += pointsInTier;
            }
            for (let i = 1; i <= tier.subTiers; i++) {
                if (tier.id === 7 || tier.id === 8) continue;
                totalPointsMap[`${tier.id}-${i}`] = pointsToStartTier[tier.id] + (tier.subTiers - i + 1) * tier.starsPerSub * tier.pointsPerStar;
            }
        });
        totalPointsMap['7-1'] = pointsToStartTier[8];
        totalPointsMap['8-1'] = pointsToStartTier[8];

        const allDOM = {
            startTier: document.getElementById("startTier"), startSubTier: document.getElementById("startSubTier"), startStars: document.getElementById("startStars"),
            targetTier: document.getElementById("targetTier"), targetSubTier: document.getElementById("targetSubTier"),
            seasonEndTier: document.getElementById("seasonEndTier"), seasonEndSubTier: document.getElementById("seasonEndSubTier"),
            calculateBtn: document.getElementById("calculateBtn"), resetBtn: document.getElementById("resetBtn"), resetFormBtn: document.getElementById("resetFormBtn"),
            resultDiv: document.getElementById("result"), resetResultDiv: document.getElementById("resetResult"), errorMessageDiv: document.getElementById("error-message"),
            factionSelect: document.getElementById("faction-select"), survivorOptions: document.getElementById("survivor-options"), hunterOptions: document.getElementById("hunter-options"),
            strongEnemyFreqSlider: document.getElementById("strongEnemyFreq"), strongEnemyFreqValue: document.getElementById("strongEnemyFreqValue")
        };

        function populateTierSelect(selectElement){ for(let i=1;i<=8;i++){const option=document.createElement("option");option.value=i;option.textContent=rankData[i-1].name;selectElement.appendChild(option)} }
        function updateSubTierSelect(tierSelect, subTierSelect, selectorType) {
            const tierId = parseInt(tierSelect.value);
            const tier = rankData.find(t => t.id === tierId);
            subTierSelect.innerHTML = '';
            if (tierId === 7 && selectorType === 'target') {
                for(let i=0; i<=24; i++) { const option = document.createElement("option"); option.value = i; option.textContent = `${i} æ˜Ÿ`; subTierSelect.appendChild(option); }
            } else if (tierId >= 7) {
                const option = document.createElement("option"); option.value = 1;
                option.textContent = (selectorType === 'target') ? "è¾¾åˆ°è¯¥æ®µä½" : (tierId === 8 ? "25æ˜Ÿä»¥ä¸Š" : "0-24æ˜Ÿ");
                subTierSelect.appendChild(option);
            } else {
                for (let i = tier.subTiers; i >= 1; i--) { const option = document.createElement("option"); option.value = i; option.textContent = `${subTierNames[i-1]}æ®µ`; subTierSelect.appendChild(option); }
            }
        }
        function updateStarSelect(){const tierId=parseInt(allDOM.startTier.value),tier=rankData.find(t=>t.id===tierId);let starsEl=document.getElementById("startStars")||document.getElementById("peakStarsInput");if(tier.name==="å·…å³°ä¸ƒé˜¶"){if(!starsEl||starsEl.tagName==="SELECT"){const input=document.createElement("input");input.type="number",input.min=25,input.value=25,input.id="startStars",starsEl.replaceWith(input)}}else{if(!starsEl||starsEl.tagName==="INPUT"){const select=document.createElement("select");select.id="startStars",starsEl.replaceWith(select),starsEl=select}starsEl.innerHTML="";const starsNeeded=tier.id===7?25:tier.starsPerSub;for(let i=0;i<starsNeeded;i++){const option=document.createElement("option");option.value=i,option.textContent=`${i} æ˜Ÿ`,starsEl.appendChild(option)}}}
        function setupSliders(){const sliders=[{id:"diligenceFreq",vId:"diligenceFreqValue"},{id:"afkFreq",vId:"afkFreqValue"},{id:"bestPerfFreq",vId:"bestPerfFreqValue"},{id:"teamEncounterFreq",vId:"teamEncounterFreqValue"},{id:"strongEnemyFreq",vId:"strongEnemyFreqValue"}];sliders.forEach(s=>{const el=document.getElementById(s.id),vEl=document.getElementById(s.vId);vEl.textContent=`${el.value}%`;el.addEventListener("input",()=>{vEl.textContent=`${el.value}%`})})}
        function togglePeakTargetInput(){allDOM.targetTier.value==="8"?document.getElementById("peak-star-target-wrapper").style.display="block":document.getElementById("peak-star-target-wrapper").style.display="none"}
        function showError(message){allDOM.errorMessageDiv.textContent=message,allDOM.errorMessageDiv.style.display="block"}
        function getPointsForRank(tierId,subTierId,stars){const tier=rankData.find(t=>t.id===tierId);if(!tier)return 0;if(tier.name==="å·…å³°ä¸ƒé˜¶")return pointsToStartTier[8]+(stars-25)*tier.pointsPerStar;let basePoints=pointsToStartTier[tierId];if(tierId<7){basePoints+=(tier.subTiers-subTierId)*tier.starsPerSub*tier.pointsPerStar}return basePoints+stars*tier.pointsPerStar}
        function getRankFromPoints(points){if(points>=pointsToStartTier[8])return{tier:8};for(let i=7;i>=1;i--){if(points>=pointsToStartTier[i])return{tier:i}}return{tier:1}}
        
        populateTierSelect(allDOM.startTier); updateSubTierSelect(allDOM.startTier, allDOM.startSubTier, 'start'); updateStarSelect();
        populateTierSelect(allDOM.targetTier); updateSubTierSelect(allDOM.targetTier, allDOM.targetSubTier, 'target');
        populateTierSelect(allDOM.seasonEndTier); updateSubTierSelect(allDOM.seasonEndTier, allDOM.seasonEndSubTier, 'seasonEnd');
        setupSliders(); togglePeakTargetInput();

        allDOM.startTier.addEventListener("change",()=>{updateSubTierSelect(allDOM.startTier, allDOM.startSubTier, 'start'),updateStarSelect()});
        allDOM.startSubTier.addEventListener("change",updateStarSelect);
        allDOM.seasonEndTier.addEventListener("change",()=>updateSubTierSelect(allDOM.seasonEndTier, allDOM.seasonEndSubTier, 'seasonEnd'));
        allDOM.targetTier.addEventListener("change",()=>{updateSubTierSelect(allDOM.targetTier, allDOM.targetSubTier, 'target'); togglePeakTargetInput();});
        
        function resetSlidersToDefault() {
            document.getElementById("diligenceFreq").value=35; document.getElementById("diligenceFreqValue").textContent="35%";
            document.getElementById("afkFreq").value=1; document.getElementById("afkFreqValue").textContent="1%";
            document.getElementById("bestPerfFreq").value=45; document.getElementById("bestPerfFreqValue").textContent="45%";
            document.getElementById("teamEncounterFreq").value=60; document.getElementById("teamEncounterFreqValue").textContent="60%";
            allDOM.strongEnemyFreqSlider.value = 70; allDOM.strongEnemyFreqValue.textContent = "70%";
        }

        allDOM.resetFormBtn.addEventListener("click",()=>{
            const currentFaction = allDOM.factionSelect.value;
            document.getElementById("calculator-form").reset();
            allDOM.factionSelect.value = currentFaction; // Restore faction after form reset
            allDOM.resultDiv.style.display="none";
            allDOM.errorMessageDiv.style.display="none";
            resetSlidersToDefault();
            togglePeakTargetInput();
            updateSubTierSelect(allDOM.startTier, allDOM.startSubTier, 'start');
            updateSubTierSelect(allDOM.targetTier, allDOM.targetSubTier, 'target'); 
            allDOM.factionSelect.dispatchEvent(new Event('change'));
        });

        allDOM.resetBtn.addEventListener("click",()=>{const tierId=allDOM.seasonEndTier.value,subTierId=allDOM.seasonEndSubTier.value,key=`${tierId}-${subTierId}`,seasonResetMap={'1-3':'1-3','1-2':'1-2','1-1':'1-1','2-4':'2-4','2-3':'2-3','2-2':'2-2','2-1':'2-1','3-5':'2-1','3-4':'3-5','3-3':'3-4','3-2':'3-3','3-1':'3-3','4-5':'3-2','4-4':'3-1','4-3':'3-1','4-2':'4-5','4-1':'4-4','5-5':'4-4','5-4':'4-3','5-3':'4-2','5-2':'4-2','5-1':'4-1','6-5':'4-1','6-4':'5-5','6-3':'5-5','6-2':'5-4','6-1':'5-4','7-1':'5-3','8-1':'5-2'};const resetKey=seasonResetMap[key];if(resetKey){const[newTierId,newSubTierId]=resetKey.split("-"),newTier=rankData[parseInt(newTierId)-1],newSubTierName=newTier.id<7?` ${subTierNames[parseInt(newSubTierId)-1]}`:"";allDOM.resetResultDiv.innerHTML=`æ–°èµ›å­£æ®µä½ä¸ºï¼š<span style="color:var(--primary-color);">${newTier.name}${newSubTierName}</span>`}else allDOM.resetResultDiv.textContent="æœªæ‰¾åˆ°è¯¥æ®µä½çš„é‡ç½®ä¿¡æ¯ã€‚"});
        
        allDOM.factionSelect.addEventListener("change",e=>{
            const isSurvivor = e.target.value === "survivor";
            allDOM.survivorOptions.style.display = isSurvivor ? "block" : "none";
            allDOM.hunterOptions.style.display = isSurvivor ? "none" : "block";
            
            if (isSurvivor) {
                allDOM.strongEnemyFreqSlider.value = 70; allDOM.strongEnemyFreqValue.textContent = "70%";
            } else {
                allDOM.strongEnemyFreqSlider.value = 10; allDOM.strongEnemyFreqValue.textContent = "10%";
            }
        });
        
        allDOM.calculateBtn.addEventListener("click",()=>{const startStarsEl=document.getElementById("startStars")||document.getElementById("peakStarsInput"),inputs={faction:allDOM.factionSelect.value,startTier:parseInt(allDOM.startTier.value),startSubTier:parseInt(allDOM.startSubTier.value),startStars:parseInt(startStarsEl.value),targetTier:parseInt(allDOM.targetTier.value),targetSubTier:parseInt(allDOM.targetSubTier.value),gameWinRate:parseFloat(document.getElementById("gameWinRate").value),totalDrawRate:parseFloat(document.getElementById("totalDrawRate").value),queueTime:parseFloat(document.getElementById("queueTime").value),matchTime:parseFloat(document.getElementById("matchTime").value),playHours:parseFloat(document.getElementById("playHours").value),isSolo:document.getElementById("isSolo").checked,diligenceFreq:parseFloat(document.getElementById("diligenceFreq").value)/100,afkFreq:parseFloat(document.getElementById("afkFreq").value)/100,bestPerfFreq:parseFloat(document.getElementById("bestPerfFreq").value)/100,teamEncounterFreq:parseFloat(document.getElementById("teamEncounterFreq").value)/100,strongEnemyFreq:parseFloat(document.getElementById("strongEnemyFreq").value)/100,peakTargetStars:parseInt(document.getElementById("peakTargetStars").value)};allDOM.errorMessageDiv.style.display="none",allDOM.resultDiv.style.display="none";if([inputs.gameWinRate,inputs.totalDrawRate,inputs.queueTime,inputs.matchTime,inputs.playHours].some(isNaN)){showError("è¯·å¡«å†™æ‰€æœ‰æ ¸å¿ƒå‚æ•°å’Œæ¸¸æˆæ—¶é—´é¡¹ã€‚");return}if(inputs.totalDrawRate>=100||inputs.gameWinRate>100){showError("èƒœç‡å’Œé¢„ä¼°å¹³å±€å æ¯”ä¸èƒ½è¶…è¿‡100%ã€‚");return}if(inputs.playHours<=0){showError("æ¯æ—¥æ’ä½æ—¶é•¿å¿…é¡»å¤§äº0ã€‚");return}const pDraw=inputs.totalDrawRate/100,gWR=inputs.gameWinRate/100,pWin=gWR*(1-pDraw),pLoss=1-pWin-pDraw;if(pLoss<0){showError("è®¡ç®—å‡ºçš„å¤±è´¥ç‡å°äº0ï¼Œè¯·æ£€æŸ¥èƒœç‡å’Œå¹³å±€ç‡è¾“å…¥ã€‚");return}let startPoints=getPointsForRank(inputs.startTier,inputs.startSubTier,inputs.startStars),targetPoints;if(inputs.targetTier===8){if(isNaN(inputs.peakTargetStars)||inputs.peakTargetStars<=25){showError("å·…å³°ä¸ƒé˜¶ç›®æ ‡æ˜Ÿæ•°å¿…é¡»å¤§äº25ã€‚");return}if(inputs.startTier===8&&inputs.peakTargetStars<=inputs.startStars){showError("å·…å³°ä¸ƒé˜¶çš„ç›®æ ‡æ˜Ÿæ•°å¿…é¡»é«˜äºå½“å‰æ˜Ÿæ•°ã€‚");return}targetPoints=pointsToStartTier[8]+(inputs.peakTargetStars-25)*30}else if(inputs.targetTier===7){targetPoints=pointsToStartTier[7]+inputs.targetSubTier*30}else{targetPoints=totalPointsMap[`${inputs.targetTier}-${inputs.targetSubTier}`]}if(startPoints>=targetPoints){showError("ç›®æ ‡æ®µä½å¿…é¡»é«˜äºåˆå§‹æ®µä½ã€‚");return}let currentPoints=startPoints,totalMatches=0;const MAX_MATCHES=1e5;let pointBreakdown={};for(;currentPoints<targetPoints;){if(totalMatches++,totalMatches>MAX_MATCHES){showError("è®¡ç®—é‡è¿‡å¤§(>10ä¸‡åœº)ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ˜¯å¦åˆç†ã€‚");return}const currentRank=getRankFromPoints(currentPoints);let avgPointsPerMatch=0,breakdown={win:0,draw:0,loss:0,performance:0,protection:0,bonus:0};if(inputs.faction==="survivor"){breakdown.win=pWin*9.5;breakdown.draw=pDraw*1;breakdown.loss=pLoss*-7;breakdown.performance=2.5;if(inputs.isSolo){breakdown.bonus+=pLoss*1.5+pDraw*1}breakdown.bonus+=(pLoss*2+pDraw*1)*inputs.diligenceFreq;breakdown.bonus+=inputs.afkFreq*2}else{breakdown.win=pWin*8.5;breakdown.draw=0;breakdown.loss=pLoss*-6.5;breakdown.performance=pWin*3.5+pDraw*2+pLoss*.5;breakdown.bonus+=(pDraw+pLoss)*inputs.bestPerfFreq;breakdown.bonus+=1.8*inputs.teamEncounterFreq}if([3,4,5].includes(currentRank.tier)&&inputs.faction==="survivor"){breakdown.bonus+=pWin+pDraw}if(currentRank.tier===2){breakdown.protection+=pLoss*5}if(currentRank.tier===3){breakdown.protection+=pLoss*3}if(currentRank.tier===4){breakdown.protection+=pLoss*2+pDraw*1}let streakBonus=pWin*(Math.pow(pLoss,2)*1+Math.pow(pLoss,3)*2+Math.pow(pLoss,4)*3+Math.pow(pLoss,5)*4);breakdown.bonus+=streakBonus;breakdown.bonus+=1.5*inputs.strongEnemyFreq;avgPointsPerMatch=Object.values(breakdown).reduce((a,b)=>a+b,0);if(avgPointsPerMatch<=0&&currentRank.tier>=5){showError("åœ¨æ­¤å‚æ•°ä¸‹ï¼Œäº”é˜¶åŠä»¥ä¸Šæ®µä½å¹³å‡å¾—åˆ†ä¸ºè´Ÿï¼Œæ— æ³•ä¸Šåˆ†ã€‚");return}currentPoints+=Math.max(.01,avgPointsPerMatch);pointBreakdown=breakdown}const totalTimePerMatch=inputs.queueTime+inputs.matchTime,totalHours=totalMatches*totalTimePerMatch/60,totalDays=totalHours/inputs.playHours;const netGain=Object.values(pointBreakdown).reduce((a,b)=>a+b,0);allDOM.resultDiv.innerHTML=`
                <h3 style="margin-top:0;">ğŸ“Š ä¸Šåˆ†è®¡åˆ’æ¦‚è§ˆ</h3>
                <p><strong>é¢„ä¼°æ€»å¯¹å±€æ•°:</strong> <span style="font-size: 1.2em; color: var(--primary-color);">${totalMatches.toLocaleString()}</span> åœº</p>
                <p><strong>â±ï¸ é¢„ä¼°æ€»è€—æ—¶:</strong> <span style="font-size: 1.2em; color: var(--primary-color);">${totalHours.toFixed(1)}</span> å°æ—¶</p>
                <p><strong>ğŸ“… é¢„ä¼°æ‰€éœ€å¤©æ•°:</strong> <span style="font-size: 1.2em; color: var(--primary-color);">${Math.ceil(totalDays)}</span> å¤©</p>
                <div style="font-size: 0.9em; margin-top: 15px; padding-top: 15px; border-top: 1px dashed #ccc;">
                    <strong>å¹³å‡æ¯å±€å¾—åˆ†æ„æˆ (ä¼°ç®—):</strong>
                    <div class="detail-item">åŸºç¡€åˆ†: <span style="color: #008f53;">+${(pointBreakdown.win+pointBreakdown.draw).toFixed(2)}</span> <span style="color: #d93025;">${pointBreakdown.loss.toFixed(2)}</span></div>
                    <div class="detail-item">æ¼”ç»åˆ†: <span style="color: #008f53;">+${pointBreakdown.performance.toFixed(2)}</span></div>
                    <div class="detail-item">æ®µä½ä¿æŠ¤: <span style="color: #008f53;">+${pointBreakdown.protection.toFixed(2)}</span></div>
                    <div class="detail-item">é¢å¤–åŠ åˆ†: <span style="color: #008f53;">+${pointBreakdown.bonus.toFixed(2)}</span> (å«å•æ’/è™½è´¥çŠ¹è£/è¿è´¥ç»ˆæ­¢/å¼ºæ•Œ/æŒ‚æœºè¡¥å¿ç­‰)</div>
                    <div class="detail-item" style="font-weight:bold; margin-top: 5px;">é¢„ä¼°å‡€æ”¶ç›Š: <span style="color:${netGain>0?"#008f53":"#d92525"}">${netGain.toFixed(2)}</span> åˆ†/å±€</div>
                </div>
            `,allDOM.resultDiv.style.display="block"});
    });
    </script>
</body>
</html>
